
{% extends "maintemplate.html" %}

{% block title %}{{ profile_user.name }}'s Profile{% endblock %}

{% block style %}

<style type="text/css">
	.in-library-button	{
		margin-bottom: 10px;
	}
</style>

{% endblock %}

{% block script %}

<script src="{{ url_for('static', filename='js/jquery.cookie.js') }}"></script>

<script type="text/javascript">
	$(function() {
		$(".tooltip-button").tooltip({trigger: "hover"});
	});
	
	function borrow_item(itemCopyID, button) {
		$.getJSON("/setup_item_borrow/" + {{ profile_user.get_id() }} + "/" + itemCopyID, function(data) {
			$(button).attr("disabled", "");
			$(button).attr("onclick", "");
			$(button).html("Requested");
			$(button).tooltip("destroy").attr("title", "Item has been requested").tooltip({trigger: "hover"});
		});
	}
</script>

{% endblock %}

{% block content %}

<div class="row">
	<div class="span12">
		<h3>User Profile</h3>
		<table class="infoTable">
			<tr>
				<td class="infoLabel">Name:</td>
				<td>{{ profile_user.name }}</td>
			</tr>
			<tr>
				<td class="infoLabel">Info:</td>
				<td>{{ profile_user.info }}</td>
			</tr>
		<table>
	</div>
</div>
<br/>
<div class="row">
	<div class="span12">
		<h4>{{ profile_user.name }}'s Library</h4>
		<table class="table table-bordered table-striped">
			<tr>
				<th>Title</th>
				<th>Author</th>
				<th style="width:160px;text-align:center">{% if profile_user.get_id() == user.get_id() %}Lend Status{% endif %}</th>
			</tr>
			{% if library|length < 1 %}
			<tr>
				{% if profile_user.get_id() == user.get_id() %}
				<td colspan='3'>You don't have any items in your library. To add items, use the search field inside the header. Once you've added items, they'll show up here.</td>
				{% else %}
				<td colspan='3'>{{ profile_user.name }} has not added any items yet.</td>
				{% endif %}
			</tr>
			{% endif %}
			{% for item in library %}
			<tr>
				<td>{{ item.title }}</td>
				<td>{{ item.author_director }}</td>
				<td style="text-align:center">
				{% if profile_user.get_id() == user.get_id() %}
					{% if item.available %}Available
					{% else %}On Loan
					{% endif %}
				{% else %}
					{% if item.available %}
					<a class="btn btn-inverse tooltip-button"
						style="width:120px"
						onclick="borrow_item('{{ item.copyid }}', this)"
						data-toggle="tooltip" 
						data-placement="right"
						title="Request to borrow item from {{ profile_user.name }}">
						Request&nbsp;to&nbsp;Borrow</a>
					{% else %}
					<a class="btn btn-inverse tooltip-button disabled"
						style="width:120px"
						data-toggled="tooltip"
						data-placement="right"
						title="Item not available">
						Unavailable</a>
					{% endif %}
				{% endif %}</td>
			</tr>
			{% endfor %}
		</table>
	</div>
</div>

{% endblock %}
